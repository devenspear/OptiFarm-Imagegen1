{% extends "base.html" %}

{% block title %}Dashboard - Optimist Farm Generator{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Header -->
    <div class="text-center">
        <h1 class="text-4xl font-bold text-gray-800 dark:text-gray-100 mb-2">Optimist Farm Studio</h1>
        <p class="text-gray-500 dark:text-gray-400">AI-powered children's storybook illustration generator</p>
    </div>

    <!-- API Status -->
    {% if not api_key_set %}
    <div class="bg-amber-50 dark:bg-amber-900/30 border border-amber-200 dark:border-amber-700 text-amber-800 dark:text-amber-200 p-4 rounded-lg">
        <div class="flex items-center">
            <span class="text-xl mr-3">âš ï¸</span>
            <div>
                <p class="font-semibold">API Key Not Set</p>
                <p class="text-sm text-amber-600 dark:text-amber-300">Run <code class="bg-amber-100 dark:bg-amber-800 px-2 py-0.5 rounded text-xs">export FAL_KEY="your-key"</code> before generating images.</p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="bg-emerald-50 dark:bg-emerald-900/30 border border-emerald-200 dark:border-emerald-700 text-emerald-800 dark:text-emerald-200 p-4 rounded-lg">
        <div class="flex items-center">
            <span class="text-xl mr-3">âœ“</span>
            <div>
                <p class="font-semibold">API Key Configured</p>
                <p class="text-sm text-emerald-600 dark:text-emerald-300">Ready to generate images (~$0.04 per image)</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 card-hover transition">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium uppercase tracking-wide">Characters</p>
                    <p class="text-3xl font-bold text-gray-800 dark:text-gray-100 mt-1">{{ characters|length }}</p>
                </div>
                <div class="w-12 h-12 bg-emerald-100 dark:bg-emerald-900/50 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ğŸ°</span>
                </div>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 card-hover transition">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium uppercase tracking-wide">Books</p>
                    <p class="text-3xl font-bold text-gray-800 dark:text-gray-100 mt-1">{{ books|length }}</p>
                </div>
                <div class="w-12 h-12 bg-indigo-100 dark:bg-indigo-900/50 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ğŸ“š</span>
                </div>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 card-hover transition">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium uppercase tracking-wide">Locations</p>
                    <p class="text-3xl font-bold text-gray-800 dark:text-gray-100 mt-1">{{ locations|length }}</p>
                </div>
                <div class="w-12 h-12 bg-amber-100 dark:bg-amber-900/50 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ğŸ¡</span>
                </div>
            </div>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6 card-hover transition">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-500 dark:text-gray-400 text-sm font-medium uppercase tracking-wide">Styles</p>
                    <p class="text-3xl font-bold text-gray-800 dark:text-gray-100 mt-1">{{ styles|length }}</p>
                </div>
                <div class="w-12 h-12 bg-violet-100 dark:bg-violet-900/50 rounded-lg flex items-center justify-center">
                    <span class="text-2xl">ğŸ¨</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Quick Actions</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <a href="/generate" class="flex items-center p-4 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-lg hover:shadow-lg transition">
                <span class="text-2xl mr-4">âœ¨</span>
                <div>
                    <p class="font-semibold">Generate Images</p>
                    <p class="text-sm opacity-90">Create hero shots, scenes, covers</p>
                </div>
            </a>
            <a href="/characters" class="flex items-center p-4 bg-gradient-to-r from-slate-600 to-slate-700 text-white rounded-lg hover:shadow-lg transition">
                <span class="text-2xl mr-4">ğŸ¾</span>
                <div>
                    <p class="font-semibold">View Characters</p>
                    <p class="text-sm opacity-90">17 characters from Writing Bible</p>
                </div>
            </a>
            <a href="/books" class="flex items-center p-4 bg-gradient-to-r from-indigo-500 to-violet-500 text-white rounded-lg hover:shadow-lg transition">
                <span class="text-2xl mr-4">ğŸ“–</span>
                <div>
                    <p class="font-semibold">Browse Books</p>
                    <p class="text-sm opacity-90">13 books with virtues</p>
                </div>
            </a>
        </div>
    </div>

    <!-- Characters Preview -->
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Characters</h2>
            <a href="/characters" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 text-sm font-medium">View All â†’</a>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            {% for char in characters[:12] %}
            <div class="text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition cursor-pointer">
                <div class="w-14 h-14 mx-auto mb-2 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 rounded-full flex items-center justify-center text-xl border border-slate-200 dark:border-slate-600">
                    {% if char.role == 'mentor' %}ğŸ¦‰
                    {% elif 'bunny' in char.id %}ğŸ°
                    {% elif 'pig' in char.id %}ğŸ·
                    {% elif 'goat' in char.id %}ğŸ
                    {% elif 'cow' in char.id %}ğŸ„
                    {% elif 'lamb' in char.id %}ğŸ‘
                    {% elif 'dog' in char.id %}ğŸ•
                    {% elif 'chick' in char.id %}ğŸ¤
                    {% elif 'duck' in char.id %}ğŸ¦†
                    {% elif 'donkey' in char.id %}ğŸ«
                    {% elif 'squirrel' in char.id %}ğŸ¿ï¸
                    {% elif 'mouse' in char.id %}ğŸ­
                    {% elif 'horse' in char.id %}ğŸ´
                    {% elif 'rooster' in char.id %}ğŸ“
                    {% elif 'snail' in char.id %}ğŸŒ
                    {% else %}ğŸ¾
                    {% endif %}
                </div>
                <p class="font-medium text-gray-800 dark:text-gray-100 text-sm">{{ char.name }}</p>
                <p class="text-xs text-gray-400 capitalize">{{ char.role }}</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Books Preview -->
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100">Books</h2>
            <a href="/books" class="text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 text-sm font-medium">View All â†’</a>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for book in books[:6] %}
            <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:border-indigo-300 dark:hover:border-indigo-500 hover:shadow-sm transition bg-white dark:bg-gray-700/50">
                <div class="flex items-start justify-between">
                    <div>
                        <span class="text-xs font-semibold text-white bg-slate-600 px-2 py-1 rounded">Book {{ book.number }}</span>
                        <h3 class="font-semibold text-gray-800 dark:text-gray-100 mt-2">{{ book.title }}</h3>
                        <p class="text-sm text-gray-500 dark:text-gray-400 capitalize">{{ book.virtue }}</p>
                    </div>
                    <span class="virtue-badge text-white text-xs px-2 py-1 rounded capitalize">{{ book.virtue }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Active Style -->
    <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
        <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4">Active Style: <span class="text-indigo-600 dark:text-indigo-400 capitalize">{{ active_style }}</span></h2>
        <div class="flex flex-wrap gap-2">
            {% for style in styles %}
            <button onclick="setStyle('{{ style.id }}')"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition border
                           {% if style.id == active_style %}
                           bg-indigo-600 text-white border-indigo-600
                           {% else %}
                           bg-white dark:bg-gray-700 text-gray-600 dark:text-gray-300 border-gray-300 dark:border-gray-600 hover:border-indigo-300 dark:hover:border-indigo-500 hover:text-indigo-600 dark:hover:text-indigo-400
                           {% endif %}">
                {{ style.name }}
            </button>
            {% endfor %}
        </div>
    </div>
</div>

<script>
async function setStyle(styleId) {
    const response = await fetch('/api/style', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({style_id: styleId})
    });
    if (response.ok) {
        location.reload();
    }
}
</script>
{% endblock %}
